
# 可视化系统搭建

## 业务痛点

* 页面类似: 页面布局和业务逻辑较固定.
* 需求高频: 每周甚至每天有多个这种需求.
* 迭代快速: 开发时间短, 上线时间紧.
* 开发性价比低: 开发任务重复, 消耗各方的沟通时间和人力.

![](https://user-gold-cdn.xitu.io/2019/2/12/168e0b5f69a0c244?imageslim)

## 前提条件

* **拥有丰富完整的物料库**。
* **搭建的目标业务不复杂**，因为核心还是利用组件 + 配置文件完成全流程。

## 技术难点

1. 页面组件化（基础）
    * 组件树组合, 页面可视化搭建变成页面组件的可视化组合.
    * 组件配置编辑, 将对页面内容的编辑转化为对组件的配置属性(props)修改.
1. 页面可视化编辑
    *  动态地给页面源码添加组件, 然后重新打包生成页面.
    * 使用配置表单来填入配置数据.
1. 组件层级关系
    * 非嵌套组件方式，实现简单，但单一，只针对某些有限场景。
    * 嵌套组件方式，实现复杂，考虑场景多。如一个父组件为行内组件, 给其添加一个块级组件作为子组件, 渲染后可能会导致行内组件被块级组件撑开.
1. 实时预览
    * 页面挂载方式。优点：实时预览，快；缺点：编译需引入组件库源码，耦合，而且组件库样式可能会污染编辑器页面。[commit](https://github.com/lq782655835/vuepress-theme-antdocs/commit/cca961eb775732fc35bab38caa7f32eb140962e1)
    * 后台渲染方式（iframe嵌入）。优点：只需要配置内容即可（编辑器和组件库解耦），后台ssr生成页面 。 缺点：ssr技术攻艰，以及后台渲染速度要快（预览实时性）
1. 页面打包
    * 输出实时预览的页面。所以上面的步骤一般选择后台渲染方式（iframe）。
    * 如何搭配自动发布系统？安全性保证？
1. 约定和约束（贡献业务组件，供上层可视化工具）
    * 页面可视化搭建工具要支持业务现有的前端框架.
    * 组件和模板的编写方式需遵循较简单的编写约定, 避免开发人员难上手和写起来不舒服.
    * 组件在开发模式下进行调试和测试

### 核心难点
1. 技术难点:页面可视化搭建工具与页面前端框架解偶.
1. 技术难点: 如何用最简单的方式生成配置数据编辑表单.
1. 技术难点: 如何组织页面组件的层级关系.
1. 技术难点: 如何实现组件库的快速后台渲染, 从而实现编辑器和组件库前端框架的分离.

### 其他问题

1. 业务单一
1. 业务组件升级
1. 搭配发布控制系统（安全保证）
1. 物料库（基础）
1. 一定会用到ssr
1. 本质上是组件 + schema校验。核心还是Vue的is
1. 预览如何拿到页面地址

### 更多

* https://www.yunfengdie.com/
* https://page-pipepline.github.io/pipeline-editor/dist/#/pipeline?templateId=1
* https://github.com/CntChen/cntchen.github.io/issues/17
* https://ice.work/docs/guide/intro



client.config -> main.js -> 浏览器代码
server.config -> main-server -> ssr


npm run server 生成ssr目标代码
npm run render: 引入ssr schame，测试渲染