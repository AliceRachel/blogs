<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Electron工程踩坑记录 | springleo&#39;s blog</title>
    <meta name="description" content="">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/blogs/dist/assets/css/0.styles.4c11730f.css" as="style"><link rel="preload" href="/blogs/dist/assets/js/app.3f3858c9.js" as="script"><link rel="preload" href="/blogs/dist/assets/js/49.9ed85908.js" as="script"><link rel="prefetch" href="/blogs/dist/assets/js/10.47923797.js"><link rel="prefetch" href="/blogs/dist/assets/js/11.3ddc1be0.js"><link rel="prefetch" href="/blogs/dist/assets/js/12.41174740.js"><link rel="prefetch" href="/blogs/dist/assets/js/13.f3a4f858.js"><link rel="prefetch" href="/blogs/dist/assets/js/14.26d48bb9.js"><link rel="prefetch" href="/blogs/dist/assets/js/15.c984d5d0.js"><link rel="prefetch" href="/blogs/dist/assets/js/16.b4c3c078.js"><link rel="prefetch" href="/blogs/dist/assets/js/17.9f1f860a.js"><link rel="prefetch" href="/blogs/dist/assets/js/18.234a9232.js"><link rel="prefetch" href="/blogs/dist/assets/js/19.f7b5256b.js"><link rel="prefetch" href="/blogs/dist/assets/js/2.335e5291.js"><link rel="prefetch" href="/blogs/dist/assets/js/20.65781238.js"><link rel="prefetch" href="/blogs/dist/assets/js/21.424e6e05.js"><link rel="prefetch" href="/blogs/dist/assets/js/22.2616efa0.js"><link rel="prefetch" href="/blogs/dist/assets/js/23.0dc8a9ca.js"><link rel="prefetch" href="/blogs/dist/assets/js/24.c5af851e.js"><link rel="prefetch" href="/blogs/dist/assets/js/25.b92e4ad2.js"><link rel="prefetch" href="/blogs/dist/assets/js/26.b5e0245b.js"><link rel="prefetch" href="/blogs/dist/assets/js/27.4bd292dd.js"><link rel="prefetch" href="/blogs/dist/assets/js/28.149edca0.js"><link rel="prefetch" href="/blogs/dist/assets/js/29.2ec81a34.js"><link rel="prefetch" href="/blogs/dist/assets/js/3.d5171b82.js"><link rel="prefetch" href="/blogs/dist/assets/js/30.1f66ed99.js"><link rel="prefetch" href="/blogs/dist/assets/js/31.114d8bbf.js"><link rel="prefetch" href="/blogs/dist/assets/js/32.93e96c9d.js"><link rel="prefetch" href="/blogs/dist/assets/js/33.d1abaf18.js"><link rel="prefetch" href="/blogs/dist/assets/js/34.d35191f5.js"><link rel="prefetch" href="/blogs/dist/assets/js/35.b40a38a3.js"><link rel="prefetch" href="/blogs/dist/assets/js/36.abb220c0.js"><link rel="prefetch" href="/blogs/dist/assets/js/37.665e89e6.js"><link rel="prefetch" href="/blogs/dist/assets/js/38.dea0b882.js"><link rel="prefetch" href="/blogs/dist/assets/js/39.20a41f4e.js"><link rel="prefetch" href="/blogs/dist/assets/js/4.78c2e315.js"><link rel="prefetch" href="/blogs/dist/assets/js/40.9fc7451a.js"><link rel="prefetch" href="/blogs/dist/assets/js/41.73913ae8.js"><link rel="prefetch" href="/blogs/dist/assets/js/42.3e0865a9.js"><link rel="prefetch" href="/blogs/dist/assets/js/43.21be1f03.js"><link rel="prefetch" href="/blogs/dist/assets/js/44.1d6bb79a.js"><link rel="prefetch" href="/blogs/dist/assets/js/45.46c3a333.js"><link rel="prefetch" href="/blogs/dist/assets/js/46.c4098b0e.js"><link rel="prefetch" href="/blogs/dist/assets/js/47.a168af0e.js"><link rel="prefetch" href="/blogs/dist/assets/js/48.63c01ef3.js"><link rel="prefetch" href="/blogs/dist/assets/js/5.b904176f.js"><link rel="prefetch" href="/blogs/dist/assets/js/50.90614a7b.js"><link rel="prefetch" href="/blogs/dist/assets/js/51.d31b76e2.js"><link rel="prefetch" href="/blogs/dist/assets/js/52.5bc38e35.js"><link rel="prefetch" href="/blogs/dist/assets/js/53.afa9db2b.js"><link rel="prefetch" href="/blogs/dist/assets/js/54.d5b78879.js"><link rel="prefetch" href="/blogs/dist/assets/js/55.3f5265f4.js"><link rel="prefetch" href="/blogs/dist/assets/js/56.cc6f33e1.js"><link rel="prefetch" href="/blogs/dist/assets/js/6.747de41c.js"><link rel="prefetch" href="/blogs/dist/assets/js/7.062196d4.js"><link rel="prefetch" href="/blogs/dist/assets/js/8.af615846.js"><link rel="prefetch" href="/blogs/dist/assets/js/9.a5aeabc8.js">
    <link rel="stylesheet" href="/blogs/dist/assets/css/0.styles.4c11730f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/dist/" class="home-link router-link-active"><!----> <span class="site-name">springleo's blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/dist/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/dist/team-standard/0.standard-ai-summary.html" class="nav-link">Standard</a></li><li class="dropdown-item"><!----> <a href="/blogs/dist/summary/recommend-vue-project-structure.html" class="nav-link">Recommend</a></li></ul></div></div> <a href="https://github.com/lq782655835/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/dist/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/dist/team-standard/0.standard-ai-summary.html" class="nav-link">Standard</a></li><li class="dropdown-item"><!----> <a href="/blogs/dist/summary/recommend-vue-project-structure.html" class="nav-link">Recommend</a></li></ul></div></div> <a href="https://github.com/lq782655835/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>团队规范</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端总结</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>思考与总结</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blogs/dist/think/grow-up-front.html" class="sidebar-link">谈谈前端天花板问题</a></li><li><a href="/blogs/dist/think/grow-up-life-it.html" class="sidebar-link">一个程序员的成长之路</a></li><li><a href="/blogs/dist/think/project-electron-summary.html" class="active sidebar-link">Electron工程踩坑记录</a></li><li><a href="/blogs/dist/think/project-h5-video-summary.html" class="sidebar-link">H5 Video踩坑记录</a></li><li><a href="/blogs/dist/think/think-cli-official-website.html" class="sidebar-link">官网脚手架思考与实践</a></li><li><a href="/blogs/dist/think/《agile-software》-reader-response.html" class="sidebar-link">《敏捷开发》读后总结</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ReacNative</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>效率工具</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="electron工程踩坑记录"><a href="#electron工程踩坑记录" aria-hidden="true" class="header-anchor">#</a> Electron工程踩坑记录</h1> <blockquote><p>最近公司有个新产品线，需要将应用打包成客户端，提供私有化部署。考虑到Web线上已经实现大部分需求，技术选型时使用Electron。本文不是帮助读者的扫盲文，只是记录下项目工程中遇到的坑，所以阅读本文需要web和electron知识。</p></blockquote> <p>应产品要求，私有化部署主要考虑windows端，mac端其次。框架选型使用<a href="https://github.com/SimulatedGREG/electron-vue" target="_blank" rel="noopener noreferrer">electron-vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>脚手架(这里也强烈推荐)，该脚手架包含Vue技术栈单页应用 + electron + 打包完整流程。内置Vuex，Vue-Router，Webpack，electron-builder等。下面的大部分实践<a href="https://github.com/lq782655835/electron-vue-template" target="_blank" rel="noopener noreferrer">源码放在这<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_1-自定义标题栏"><a href="#_1-自定义标题栏" aria-hidden="true" class="header-anchor">#</a> 1. 自定义标题栏</h2> <p>这应该是每一个使用electron实现web客户端都会遇到的问题，使用原生的外边框，第一太丑，第二也不统一。</p> <p>解决方案：frame + css drag</p> <p><code>frame: false</code>: 主进程中设置窗体参数。去掉默认的标题栏</p> <p><code>-webkit-app-region: drag</code>: 渲染进程中设置css。对应的组件可以进行拖动了</p> <div class="language-js extra-class"><pre class="language-js"><code>mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    height<span class="token punctuation">:</span> <span class="token number">350</span><span class="token punctuation">,</span>
    width<span class="token punctuation">:</span> <span class="token number">550</span><span class="token punctuation">,</span>
    useContentSize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    resizable<span class="token punctuation">:</span> isDev<span class="token punctuation">,</span> <span class="token comment">// 是否可调整大小</span>
    alwaysOnTop<span class="token punctuation">:</span> <span class="token operator">!</span>isDev<span class="token punctuation">,</span> <span class="token comment">// 应用是否始终在所有顶层之上</span>
    transparent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 透明边框</span>
    frame<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不使用默认边框</span>
    center<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.u-header</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
    <span class="token property">-webkit-app-region</span><span class="token punctuation">:</span> drag<span class="token punctuation">;</span> <span class="token comment">/* as window header */</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-标题栏按钮无效-only-windows"><a href="#_2-标题栏按钮无效-only-windows" aria-hidden="true" class="header-anchor">#</a> 2. 标题栏按钮无效  -- only windows</h2> <p>该bug只在windows平台上显示，mac上正常。在header组件中设置为drag，导致组件里的元素都无法点击。</p> <p>解决方案：在需要点击的元素上添加no-drag。<code>-webkit-app-region: no-drag;</code>详细看此<a href="https://github.com/electron/electron/issues/1354" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_3-自定义标题栏无法实现css-hover-only-windows"><a href="#_3-自定义标题栏无法实现css-hover-only-windows" aria-hidden="true" class="header-anchor">#</a> 3. 自定义标题栏无法实现css hover -- only windows</h2> <p>当设置了为drag时，在windows上会屏蔽所有的鼠标事件,所以hover不起作用。这是一个由操作系统导致的问题，故无法修复，相关<a href="https://github.com/electron/electron/issues/13534" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>解决方案：去掉<code>-webkit-app-region: drag;</code>即可。</p> <blockquote><p>如果要同时保留可拖动并且hover上有变化，在windows暂时无法实现，需要对此进行取舍或改变交互设计。</p></blockquote> <h2 id="_4-打包后程序调试"><a href="#_4-打包后程序调试" aria-hidden="true" class="header-anchor">#</a> 4. 打包后程序调试</h2> <p>electron-vue在开发环境默认启用electron-debug插件开启调试。但打包完成，交付到测试同学手里，需要在错误的时候打开开发者工具定位问题。</p> <p>解决方案：通过注册快捷键，调开web的开发者模式。</p> <div class="language-js extra-class"><pre class="language-js"><code>globalShortcut<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'CommandOrControl+Shift+L'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> focusWin <span class="token operator">=</span> BrowserWindow<span class="token punctuation">.</span><span class="token function">getFocusedWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    focusWin <span class="token operator">&amp;&amp;</span> focusWin<span class="token punctuation">.</span><span class="token function">toggleDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_5-文本不可选择"><a href="#_5-文本不可选择" aria-hidden="true" class="header-anchor">#</a> 5. 文本不可选择</h2> <p>既然作为客户端，就应该像个客户端程序，不能对展示型的文本进行用户选择。</p> <p>解决方案：使用css <code>-webkit-user-select: none;</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">html</span> <span class="token punctuation">{</span>
    <span class="token property">-webkit-tap-highlight-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
    <span class="token property">-webkit-text-size-adjust</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token comment">/* disable user select text */</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-打包参数设置"><a href="#_6-打包参数设置" aria-hidden="true" class="header-anchor">#</a> 6. 打包参数设置</h2> <p>electron应用需要进行打包，变成exe可执行文件给用户。推荐使用最新的electron-builder进行打包（electron-vue脚手架中有提供该选项）。这里对常用的设置进行说明</p> <div class="language-json extra-class"><pre class="language-json"><code>scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
    /** 打包成windows系统 **/
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node .electron-vue/build.js &amp;&amp; electron-builder --win&quot;</span><span class="token punctuation">,</span>
    /** 打包成macos系统 **/
    <span class="token property">&quot;build:mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node .electron-vue/build.js &amp;&amp; electron-builder --mac&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    /** 最终可执行文件名称：$<span class="token punctuation">{</span>productName<span class="token punctuation">}</span>-$<span class="token punctuation">{</span>version<span class="token punctuation">}</span>.$<span class="token punctuation">{</span>ext<span class="token punctuation">}</span> **/
    <span class="token property">&quot;productName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sight-electron-app&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;appId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;netease.sight.controller&quot;</span><span class="token punctuation">,</span>
    /** 压缩形式，默认normal<span class="token punctuation">;</span>store打包最快，适合测试<span class="token punctuation">;</span>maximum打包体积最小，适合生产模式 **/
    <span class="token property">&quot;compression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;maximum&quot;</span><span class="token punctuation">,</span>
    /** 是否将多个文件合并为tar风格的归档模式 **/
    <span class="token property">&quot;asar&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;directories&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span>  /** 打包结果目标地址 **/
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;dist/electron/**/*&quot;</span> /** 需要打包的文件地址 **/
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    /** 不同平台设置 **/
    <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/icons/icon.icns&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;win&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/icons/icon.ico&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/icons&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-触摸板放大缩小-only-mac"><a href="#_7-触摸板放大缩小-only-mac" aria-hidden="true" class="header-anchor">#</a> 7. 触摸板放大缩小 -- only mac</h2> <p>在macOS系统中，触摸板的放大缩小手指指令，会导致electron程序内的webFrame内容也跟着放大缩小。</p> <p>解决方案：在renderer进程中设置其缩放范围<code>require('electron').webFrame.setZoomLevelLimits(1, 1)</code></p> <h2 id="_8-web端唤起本地客户端"><a href="#_8-web端唤起本地客户端" aria-hidden="true" class="header-anchor">#</a> 8. web端唤起本地客户端</h2> <p>electron提供该API能力：<code>app.setAsDefaultProtocolClient(protocol[, path, args])</code></p> <h2 id="_9-禁止多开窗口"><a href="#_9-禁止多开窗口" aria-hidden="true" class="header-anchor">#</a> 9. 禁止多开窗口</h2> <p>多次双击window 的exe文件，会开启多个窗口；mac下默认开1个，但通过命令还是可以多开。</p> <p>解决方案：判断单实例：<code>app.makeSingleInstance(callback)</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 防止应用多开。bugfix:sholudQuit总是返回true，故暂时注释以下代码
 * 当进程是第一个实例时，返回false。
 * 如果是第二个实例时，返回true，并且执行第一个实例的回调函数
 */</span>
<span class="token keyword">const</span> shouldQuit <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">makeSingleInstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>commandLine<span class="token punctuation">,</span> workingDir<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mainWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mainWindow<span class="token punctuation">.</span><span class="token function">isMinimized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mainWindow<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mainWindow<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>shouldQuit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-网络状态检测"><a href="#_10-网络状态检测" aria-hidden="true" class="header-anchor">#</a> 10. 网络状态检测</h2> <p>客户端经常遇见断网情况处理，当网络断开时需要给用户提示，当网络连接时继续服务。通常web情况下是采取<code>轮询</code>服务器方式，但这种方式比较消耗服务器性能。这里可以利用electron的node工具包<code>public-ip</code>进行判断。public-ip查询dns获取公网ip地址，如果能拿到值表示联网正常。本来到此可以很好的解决，但产品要求的客户端，<b>既要提供公共部署，也需要进行无外网情况下的私有化部署</b>。</p> <p>解决方案：<code>public-ip + 轮询</code>方式。优先进行公网IP查询，如果成立则返回网络状态良好，如果查询不到再进行服务器心跳检查。实现方式参考<a href="https://github.com/sindresorhus/is-online" target="_blank" rel="noopener noreferrer">is-online<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_11-日志监听"><a href="#_11-日志监听" aria-hidden="true" class="header-anchor">#</a> 11. 日志监听</h2> <p>每个系统的异常监控都必不可少，特别是私有化部署客户端这种模式，日志记录显得必不可少。由于electron拥有node的环境，结合window.onerror收集错误信息,前端把日志记录在本地文件。当出现问题时，用户可以直接把日志文件发给开发者，从而定位原因。如果是网络版模式，可以通过Ajax收集错误信息。如果是程序异常崩溃，window.onerror可能没法监测的到，好在electron提供了CrashReporter收集</p> <p>解决方案：推荐<a href="https://github.com/megahertz/electron-log" target="_blank" rel="noopener noreferrer">electron-log<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> + <a href="https://thorsten-hans.com/electron-crashreporter-stay-up-to-date-if-your-app-fucked-up-3e9a989cd0a0" target="_blank" rel="noopener noreferrer">CrashReporter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron-log'</span><span class="token punctuation">)</span>

log<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>file<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token string">'info'</span>
log<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>file<span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token string">'{h}:{i}:{s}:{ms} {text}'</span>
log<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>file<span class="token punctuation">.</span>maxSize <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>
log<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>console<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token boolean">false</span>

</code></pre></div><h2 id="_12-自动更新"><a href="#_12-自动更新" aria-hidden="true" class="header-anchor">#</a> 12. 自动更新</h2> <p>该需求停留在调研，这篇<a href="https://segmentfault.com/a/1190000007616641" target="_blank" rel="noopener noreferrer">文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>讲的非常详细,待实践好再来续更</p> <p>最后，附上@changkun的electron深度总结思维导图，总结的非常棒，许多细节使笔者受益良多。<a href="https://changkun.us/archives/2017/03/217/" target="_blank" rel="noopener noreferrer">出处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="https://changkun.us/images/posts/217/mind.png" alt></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/lq782655835/blogs/edit/master/docs/think/project-electron-summary.md" target="_blank" rel="noopener noreferrer">帮助我改进页面内容！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">12/11/2018, 4:49:00 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blogs/dist/think/grow-up-life-it.html" class="prev">
          一个程序员的成长之路
        </a></span> <span class="next"><a href="/blogs/dist/think/project-h5-video-summary.html">
          H5 Video踩坑记录
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blogs/dist/assets/js/49.9ed85908.js" defer></script><script src="/blogs/dist/assets/js/app.3f3858c9.js" defer></script>
  </body>
</html>
