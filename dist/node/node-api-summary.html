<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node-常用API | springleo&#39;s blog</title>
    <meta name="description" content="">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/blogs/dist/assets/css/0.styles.4c11730f.css" as="style"><link rel="preload" href="/blogs/dist/assets/js/app.5da0cf1a.js" as="script"><link rel="preload" href="/blogs/dist/assets/js/21.28e649dd.js" as="script"><link rel="prefetch" href="/blogs/dist/assets/js/10.3b242ab0.js"><link rel="prefetch" href="/blogs/dist/assets/js/11.952e81db.js"><link rel="prefetch" href="/blogs/dist/assets/js/12.f8c48620.js"><link rel="prefetch" href="/blogs/dist/assets/js/13.4d88a576.js"><link rel="prefetch" href="/blogs/dist/assets/js/14.a099a6c4.js"><link rel="prefetch" href="/blogs/dist/assets/js/15.78392724.js"><link rel="prefetch" href="/blogs/dist/assets/js/16.8bed60d6.js"><link rel="prefetch" href="/blogs/dist/assets/js/17.1c906c67.js"><link rel="prefetch" href="/blogs/dist/assets/js/18.0fd1fd31.js"><link rel="prefetch" href="/blogs/dist/assets/js/19.729f914c.js"><link rel="prefetch" href="/blogs/dist/assets/js/2.bc115c00.js"><link rel="prefetch" href="/blogs/dist/assets/js/20.a7b03389.js"><link rel="prefetch" href="/blogs/dist/assets/js/22.3947e009.js"><link rel="prefetch" href="/blogs/dist/assets/js/23.83721a9f.js"><link rel="prefetch" href="/blogs/dist/assets/js/24.efce258d.js"><link rel="prefetch" href="/blogs/dist/assets/js/25.6beeafee.js"><link rel="prefetch" href="/blogs/dist/assets/js/26.8caaf485.js"><link rel="prefetch" href="/blogs/dist/assets/js/27.2cff0312.js"><link rel="prefetch" href="/blogs/dist/assets/js/28.79ea16a0.js"><link rel="prefetch" href="/blogs/dist/assets/js/29.4cfba903.js"><link rel="prefetch" href="/blogs/dist/assets/js/3.55edbe28.js"><link rel="prefetch" href="/blogs/dist/assets/js/30.7c22cd0a.js"><link rel="prefetch" href="/blogs/dist/assets/js/31.05ca2191.js"><link rel="prefetch" href="/blogs/dist/assets/js/32.ad3bee8c.js"><link rel="prefetch" href="/blogs/dist/assets/js/33.d9121927.js"><link rel="prefetch" href="/blogs/dist/assets/js/34.34716945.js"><link rel="prefetch" href="/blogs/dist/assets/js/35.0352bf6c.js"><link rel="prefetch" href="/blogs/dist/assets/js/36.372fe96b.js"><link rel="prefetch" href="/blogs/dist/assets/js/37.262fe2c7.js"><link rel="prefetch" href="/blogs/dist/assets/js/38.5283b10a.js"><link rel="prefetch" href="/blogs/dist/assets/js/39.877a6bf5.js"><link rel="prefetch" href="/blogs/dist/assets/js/4.a5f8b140.js"><link rel="prefetch" href="/blogs/dist/assets/js/40.8badf0f4.js"><link rel="prefetch" href="/blogs/dist/assets/js/41.bce5a44f.js"><link rel="prefetch" href="/blogs/dist/assets/js/42.d2fa8705.js"><link rel="prefetch" href="/blogs/dist/assets/js/43.d529c4c8.js"><link rel="prefetch" href="/blogs/dist/assets/js/44.6a9e04e1.js"><link rel="prefetch" href="/blogs/dist/assets/js/45.33ca9da9.js"><link rel="prefetch" href="/blogs/dist/assets/js/46.1c1fb99e.js"><link rel="prefetch" href="/blogs/dist/assets/js/47.cf8c9295.js"><link rel="prefetch" href="/blogs/dist/assets/js/48.8340648e.js"><link rel="prefetch" href="/blogs/dist/assets/js/49.76a032c7.js"><link rel="prefetch" href="/blogs/dist/assets/js/5.20862fb6.js"><link rel="prefetch" href="/blogs/dist/assets/js/50.c9e73671.js"><link rel="prefetch" href="/blogs/dist/assets/js/51.72957a01.js"><link rel="prefetch" href="/blogs/dist/assets/js/52.31fc8853.js"><link rel="prefetch" href="/blogs/dist/assets/js/53.fc1f425c.js"><link rel="prefetch" href="/blogs/dist/assets/js/54.699f927b.js"><link rel="prefetch" href="/blogs/dist/assets/js/55.cc1be2f7.js"><link rel="prefetch" href="/blogs/dist/assets/js/56.e95a7467.js"><link rel="prefetch" href="/blogs/dist/assets/js/57.6bedbb42.js"><link rel="prefetch" href="/blogs/dist/assets/js/58.9b5e22dd.js"><link rel="prefetch" href="/blogs/dist/assets/js/59.fc50deb8.js"><link rel="prefetch" href="/blogs/dist/assets/js/6.6d24607f.js"><link rel="prefetch" href="/blogs/dist/assets/js/60.106edee1.js"><link rel="prefetch" href="/blogs/dist/assets/js/61.1c163eb0.js"><link rel="prefetch" href="/blogs/dist/assets/js/62.33e709d4.js"><link rel="prefetch" href="/blogs/dist/assets/js/63.6fdb4a5d.js"><link rel="prefetch" href="/blogs/dist/assets/js/64.11519bb2.js"><link rel="prefetch" href="/blogs/dist/assets/js/7.534fdfe5.js"><link rel="prefetch" href="/blogs/dist/assets/js/8.580659a8.js"><link rel="prefetch" href="/blogs/dist/assets/js/9.6d5dafd8.js">
    <link rel="stylesheet" href="/blogs/dist/assets/css/0.styles.4c11730f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/dist/" class="home-link router-link-active"><!----> <span class="site-name">springleo's blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/dist/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/dist/team-standard/0.standard-ai-summary.html" class="nav-link">Standard</a></li><li class="dropdown-item"><!----> <a href="/blogs/dist/summary/recommend-vue-project-structure.html" class="nav-link">Recommend</a></li></ul></div></div> <a href="https://github.com/lq782655835/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/dist/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blogs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/dist/team-standard/0.standard-ai-summary.html" class="nav-link">Standard</a></li><li class="dropdown-item"><!----> <a href="/blogs/dist/summary/recommend-vue-project-structure.html" class="nav-link">Recommend</a></li></ul></div></div> <a href="https://github.com/lq782655835/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>团队规范</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端总结</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>NodeJS</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blogs/dist/node/nginx.html" class="sidebar-link">Nginx反向代理</a></li><li><a href="/blogs/dist/node/node-api-summary.html" class="active sidebar-link">Node-常用API</a></li><li><a href="/blogs/dist/node/node-express-api.html" class="sidebar-link">Express API及源码解析</a></li><li><a href="/blogs/dist/node/node-mongodb.html" class="sidebar-link">mongodb指南</a></li><li><a href="/blogs/dist/node/node-tool-package.html" class="sidebar-link">Node-常用包总结</a></li><li><a href="/blogs/dist/node/node-vscode-debug.html" class="sidebar-link">Node-Debug for VSCode</a></li><li><a href="/blogs/dist/node/shell-vim.html" class="sidebar-link">Shell &amp;&amp; Vim</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>思考与总结</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ReacNative</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>效率工具</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="node-常用api"><a href="#node-常用api" aria-hidden="true" class="header-anchor">#</a> Node-常用API</h1> <p>总结NodeJS常用的API，重点地方有笔者的释义以及详细说明。关联度高的模块放一起叙述，并有对比说明，比如buffer与fs，stream与http，process与child_process。本文尽量做到兼具实用与API广度，更多详细内容请看<a href="https://nodejs.org/dist/latest-v11.x/docs/api/" target="_blank" rel="noopener noreferrer">Node.JS官网文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="path"><a href="#path" aria-hidden="true" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v11.x/docs/api/path.html" target="_blank" rel="noopener noreferrer">path<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <ul><li><code>__filename</code>。全局值，当前文件绝对路径</li> <li><code>__dirname</code>。全局值，当前文件夹绝对路径。等效于path.resolve(__filename, '..')</li> <li><code>path.join([...paths])</code>。相当于把所传入的任意多的参数 按照顺序 进行命令行般的推进</li> <li><code>path.resolve([...paths])</code>。以当前文件的路径为起点，<strong>返回绝对路径</strong>。可以理解为每次都是新建cd命令</li> <li><code>path.dirname(path)</code>。返回指定路径<strong>所在文件夹的路径</strong></li> <li><code>path.basename(path)</code>。返回指定Path路径<strong>所在文件的名字</strong></li> <li><code>path.extname(path)</code>。获取指定字符串或者文件路径<strong>名字的后缀名</strong>，带.比如.txt</li> <li><code>path.isAbsolute(path)</code> 是否是绝对路径,返回boolean值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'../c/lolo'</span><span class="token punctuation">)</span> <span class="token comment">// a/c/lolo</span>

path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">'/b'</span><span class="token punctuation">)</span> <span class="token comment">// '/b'</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./a'</span><span class="token punctuation">,</span> <span class="token string">'./b'</span><span class="token punctuation">)</span> <span class="token comment">// '/User/../a/b'</span>

<span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token string">'./bar/baz/asdf/quux.html'</span>
path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token comment">// quux.html</span>
path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token comment">// ./bar/baz/asdf</span>
path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token comment">// .html</span>
path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h2 id="url"><a href="#url" aria-hidden="true" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v11.x/docs/api/url.html" target="_blank" rel="noopener noreferrer">url<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>url 模块提供了两套 API 来处理 URL 字符串：一个是Node.js特有的API，是旧版本的遗留；另一个则是实现了WHATWG URL Standard的 API (const {URL} = require('url')方式)，该标准也在各种浏览器中被使用。</p> <p>旧版url api，<a href="http://nodejs.cn/api/url.html#url_the_whatwg_url_api" target="_blank" rel="noopener noreferrer">新版URL Standard见这<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <ul><li><code>url.parse(urlString[, parseQueryString[, slashesDenoteHost]])</code>。把url字符串解析为url对象
<ul><li>host</li> <li>hostname</li> <li><strong>href</strong></li> <li><strong>path</strong></li> <li>pathname</li> <li>port</li> <li>protocol</li> <li><strong>query</strong></li> <li>search</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myURL <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'https://example.org/foo?type=123#123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myURL<span class="token punctuation">)</span>
<span class="token comment">/* Url {
  protocol: 'https:',
  slashes: true,
  auth: null,
  host: 'example.org',
  port: null,
  hostname: 'example.org',
  hash: '#123',
  search: '?type=123',
  query: 'type=123',
  pathname: '/foo',
  path: '/foo?type=123',
  href: 'https://example.org/foo?type=123#123'
} */</span>
</code></pre></div><ul><li><code>url.format(urlObject)</code>。把url对象解析为字符串</li> <li><code>url.resolve(from, to)</code>。以一种 Web 浏览器解析超链接的方式, 基于一个基础 URL,对目标 URL进行解析。查看其源码实现：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Url<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>relative<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveObject</span><span class="token punctuation">(</span><span class="token function">urlParse</span><span class="token punctuation">(</span>relative<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="querystring"><a href="#querystring" aria-hidden="true" class="header-anchor">#</a> <a href>querystring</a></h2> <ul><li><code>querystring.parse</code>。一个URL查询字符串 str 解析成一个键值对的集合。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> query <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'type=123'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token comment">// { type: '123' }</span>
</code></pre></div><ul><li><code>querystring.stringify</code>。遍历给定的 obj 对象的自身属性，生成 URL 查询字符串。</li></ul> <h2 id="stream"><a href="#stream" aria-hidden="true" class="header-anchor">#</a> <a href>Stream</a></h2> <p><strong>Node中很多数据结构都继承自Stream</strong>。Stream在文件系统和http请求中，有非常大的作用。</p> <ul><li><code>对于文件处理</code>，小文件对于buffer数据结构能很好的解决，直接将文件所有数据加载到内存中；但对于大文件，buffer这种方式不可取，容易打爆内存。最好的方式是像流水一样，将读取的数据实时流入到写入的文件，直到数据全部读完并写入好对应目标文件。举个例子，就像两个水池，待读取的文件是一个装满水的池子，写入的空文件是一个等待蓄满水的空池子。通过Stream API的方式，将两个池子嫁接起来，使得满水的池子可以持续注水到空池子中。而且Stream继承自EmitEvents，过程中会有许多回调事件发出，供开发人员自定义内容。</li> <li><code>对于http请求处理</code>，最常见的就是通过流去写入内容。</li></ul> <p>以下对象继承了可读流：</p> <ul><li><strong>HTTP responses, on the client</strong></li> <li><strong>HTTP requests, on the server</strong></li> <li><strong>fs read streams</strong></li> <li><strong>child process stdout and stderr</strong></li> <li><strong>process.stdin</strong></li> <li>zlib streams</li> <li>crypto streams</li> <li>TCP sockets</li></ul> <h3 id="stream类"><a href="#stream类" aria-hidden="true" class="header-anchor">#</a> <strong>Stream类</strong></h3> <ul><li><code>stream.Writable</code> <ul><li><strong>write()</strong> 写入数据到流</li> <li><strong>end()</strong> 表明已没有数据要被写入</li> <li>Events
<ul><li><strong>drain</strong>。 每个数据块写入成功后回调事件，可能多次触发。</li> <li>pipe。当readableStream.pipe()调用时回调事件</li> <li>finish。 当writeableStream.end()调用并数据读完后回调事件。</li> <li>close</li> <li>error</li></ul></li></ul></li> <li><code>stream.Readable</code> <ul><li>pipe(destination:stream.Writable, options) 把可读数据流入可写流中</li> <li>pause() 流暂停。使读取流暂停emit 'data'事件</li> <li>resume() 流重启。重新开始emit 'data'事件</li> <li>unpipe()</li> <li>Events
<ul><li><strong>data</strong>。每次读取完一段数据块回调事件，可能多次触发。</li> <li>readable。数据读取可用时回调事件。</li> <li><strong>end</strong>。 数据全部读取完成回调事件。</li> <li>close</li> <li>error</li></ul></li></ul></li> <li>stream.Duplex</li> <li>stream.Transform</li></ul> <p>以下举一个完整例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./node/snapshot/test1.png'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./node/snapshot/test1-copy.png'</span><span class="token punctuation">)</span>

readStream
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当读取较大文件时，写入流的速度可能没有读入的速度快</span>
        <span class="token comment">// 所以这里做了一个处理，没写完暂停读入流</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>writeStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            readStream<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> writeStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 这里配合上面pause，写完了继续读入流</span>
writeStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drain'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> readStream<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 以上换成管道的方式，只需一行代码：readStream.pipe(writeStream)</span>
</code></pre></div><h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> <a href>http</a></h2> <ul><li><code>http.Server</code>。http.createServer(function(req, res){})返回该类实例。
<ul><li>listen()</li></ul></li> <li><code>http.IncomingMessage</code>。 请求类。http.createServer回调函数中req参数即是该类的实例。
<ul><li>headers
<ul><li>accept</li> <li>host</li> <li>cookie 未经过处理的cookie字符串，所以一般需要cookie-parse等第三方包处理</li> <li>referer</li></ul></li> <li>url</li> <li>method</li></ul></li> <li><code>http.ServerResponse</code>。<code>Node作为服务端</code>。http.createServer回调函数中res参数即是该类的实例。
<ul><li><code>可写流</code></li> <li>write(chunk[, encoding][, callback])</li> <li>end([data][, encoding][, callback])
<ul><li>如果带data数据，相当于<code>response.write(data, encoding) + response.end(callback)</code></li></ul></li> <li>setHeader(name, value) 设置name头信息。<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers" target="_blank" rel="noopener noreferrer">所有HTTP消息头<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Content-Type。<a href="http://tool.oschina.net/commons" target="_blank" rel="noopener noreferrer">所有Content-Type<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>application/json</li> <li>text/html</li> <li>text/plain</li> <li>text/xml</li> <li>application/x-www-form-urlencoded</li> <li>multipart/form-data。常用来上传图片等数据</li></ul></li> <li>Content-Length</li> <li>Access-Control-Allow-Origin</li> <li>Access-Control-Allow-Headers</li> <li>Access-Control-Allow-Methods</li> <li>Access-Control-Allow-Credentials</li> <li>X-Powered-By</li></ul></li> <li>getHeader(name) 获得name指定头信息</li> <li>writeHead(statusCode[, statusMessage][, headers]) 设置头信息，包括状态码</li></ul></li> <li><code>http.ClientRequest</code>。<code>Node作为客户端</code>。http.get()/http.request()返回该类。
<ul><li><code>可写流</code>。跟http.ServerResponse有些类似</li> <li>write(chunk[, encoding][, callback])。stream继承，请求写入数据，一般是POST请求需要。</li> <li>end([data][, encoding][, callback])。stream继承，请求发出。</li> <li>setHeader(name, value) 设置name头信息</li> <li>getHeader(name) 获得name指定头信息</li> <li><code>回调函数res参数是可读流</code></li></ul></li></ul> <blockquote><p>IncomingMessage对象是由http.Server或http.ClientRequest创建的</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Node作为客户端发送请求</span>
<span class="token keyword">const</span> postData <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'Hello World!'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  hostname<span class="token punctuation">:</span> <span class="token string">'www.google.com'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span> <span class="token string">'/upload'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 响应值res作为从目标接口中获取到的值，是个readable.Stream</span>
  res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`BODY: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunk<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'No more data in response.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`problem with request: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// req作为客户端请求，是个writeable.Stream。</span>
req<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 带上参数</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束写入，开始发送请求。如果是http.get() API会自动带req.end()</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Node作为服务端，res(response)参数继承的是writeable.Stream</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>http.get()与 http.request() 唯一的区别是它设置请求方法为 GET 且自动调用 req.end()</p></blockquote> <blockquote><p>在node是客户端的时候，req是从node这边发起的，是可写流，res是从外边响应的，是可读流。</p></blockquote> <blockquote><p>在node是服务端的时候，req是从客户端发起的，是可读流，res是从node响应的，是可写流。</p></blockquote> <h2 id="bufferglobal"><a href="#bufferglobal" aria-hidden="true" class="header-anchor">#</a> <a href>Buffer</a><sup><code>global</code></sup></h2> <p>在 TCP 流或文件系统操作等场景中处理字节流。Buffer 类是一个全局变量。Buffer 类的实例类似于整数数组，但 Buffer 的大小是固定的、且在 V8 堆外分配物理内存。 Buffer 的大小在创建时确定，且无法改变。</p> <blockquote><p>Node.js v6.0.0 之前，Buffer 实例是通过 Buffer 构造函数创建的，它根据参数返回不同的 Buffer。为了使 Buffer 实例的创建更可靠，new Buffer() 构造函数已被废弃，建议使用 Buffer.from()、Buffer.alloc()和 Buffer.allocUnsafe()</p></blockquote> <ul><li><code>创建Buffer</code> <ul><li>new Buffer(number/string/array)<sup><code>Deprecated</code></sup>。推荐使用 Buffer.from(array/string) 和Buffer.alloc(size)代替。</li> <li><strong>Buffer.from(array/string)</strong></li> <li>Buffer.alloc(size)</li></ul></li> <li><code>Buffer静态方法</code> <ul><li>Buffer.isBuffer(obj)</li> <li>Buffer.byteLength(string)</li> <li>Buffer.concat()</li> <li>Buffer.compare()</li></ul></li> <li><code>Buffer实例</code> <ul><li>length</li> <li>toString() buffer转为string</li> <li><strong>write(string, offset=0, length, encoding='utf8')</strong>。对buffer对象写入string</li> <li>copy()</li> <li>slice()</li> <li>compare()</li> <li>equals()</li> <li>fill()</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span> <span class="token comment">// 初始化之后,实例buf长度无法改变</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11, hello world</span>

buf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'temp'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11, tempo world</span>

buf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'01234567891234567890'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11, 01234567891</span>
</code></pre></div><h2 id="file-system"><a href="#file-system" aria-hidden="true" class="header-anchor">#</a> <a href="https://nodejs.org/dist/latest-v11.x/docs/api/fs.html" target="_blank" rel="noopener noreferrer">File System<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <ul><li><code>file文件操作</code> <ul><li><p><strong>readFile(path[, options], callback)</strong></p> <ul><li>没有指定 encoding，则返回原始的 buffer</li></ul></li> <li><p><strong>writeFile(file, data[, options], callback)</strong></p> <ul><li>如果文件已存在，则覆盖文件。</li> <li>data支持 string/Buffer/TypedArray/DataView</li> <li>data 是一个 buffer，则忽略 encoding</li></ul></li> <li><p>copyFile(src, dest[, flags], callback)</p></li> <li><p>rename(oldPath, newPath, callback)。文件重命名</p></li> <li><p>write(fd, string[, positinon[, encoding]], callback)。将 string 写入到 fd 指定的文件写文件</p></li> <li><p>exists(url, callback(boolean))<sup><code>Deprecated</code></sup>。查询是否存在，<code>一般用在单纯检查文件</code>而不去操作(open/readFile/writeFile等操作文件不成立时会回调err)文件时。推荐使用fs.stat() or fs.access() 代替该方法。</p></li> <li><p><strong>stat(path[, options],callback(err, stat))</strong>。查询文件/目录信息</p> <ul><li>stat.isFile 是否一个普通文件</li> <li>stat.isDirectory 是否一个目录</li> <li>stat.ctime 最后一次修改文件的时间</li></ul></li> <li><p>createReadStream(path[, options])。 指定路径读取，获得Readable Stream。</p></li> <li><p>createWriteStream(path[, options])。创建空的写入流到目标路径，获得Writeable Stream。</p></li></ul></li> <li><code>dir目录操作</code> <ul><li><strong>readdir(path[, options], callback)</strong>。读目录，获取目录下的<code>所有文件和文件夹</code>名称。</li> <li>rmdir(path, callback)。移除目录</li></ul></li></ul> <blockquote><p>文件操作的path参数，绝对路径和相对路径都支持（相对路径基于process.cwd()）。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> dir <span class="token operator">=</span> <span class="token string">'./node/snapshot'</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">'test1.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">'test1_copy.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="processglobal"><a href="#processglobal" aria-hidden="true" class="header-anchor">#</a> <a href="https://nodejs.org/api/process.html" target="_blank" rel="noopener noreferrer">Process<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><sup><code>global</code></sup></h2> <p>process对象是一个提供当前node进程信息的全局对象，所以该对象不需要require()引入。process同时也是<a href="https://nodejs.org/api/events.html#events_class_eventemitter" target="_blank" rel="noopener noreferrer">EventEmitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（典型的发布订阅模式案例）的一个实例，所以有.on()等方法。</p> <ul><li><p><code>process.argv</code>。一个包含命令行参数的数组。第一个元素是’node’，第二个元素是JavaScript文件的文件名。接下来的元素则是附加的命令行参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// process.js</span>
process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// output</span>
$ node process<span class="token punctuation">.</span>js one two<span class="token operator">=</span>three four
<span class="token number">0</span><span class="token punctuation">:</span> node
<span class="token number">1</span><span class="token punctuation">:</span> <span class="token operator">/</span>Users<span class="token operator">/</span>node<span class="token operator">/</span>process<span class="token punctuation">.</span>js
<span class="token number">2</span><span class="token punctuation">:</span> one
<span class="token number">3</span><span class="token punctuation">:</span> two<span class="token operator">=</span>three
<span class="token number">4</span><span class="token punctuation">:</span> four
</code></pre></div></li> <li><p><code>process.env</code>。返回用户设置的环境变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span> <span class="token comment">// production</span>

<span class="token comment">// output</span>
$ cross<span class="token operator">-</span>env <span class="token constant">NODE_ENV</span><span class="token operator">=</span>production node index
production
</code></pre></div></li> <li><p><code>process.cwd()</code>。返回当前进程的工作目录</p> <blockquote><p>和 __dirname 不同, __dirname 返回的是当前文件的所在目录</p></blockquote></li> <li><p><code>process.exit()</code>。退出当前程序。</p> <blockquote><p>当执行exit()方法时，可以使用<code>process.on('exit', callback)</code>作为退出程序前的清理工作。</p></blockquote></li> <li><p><code>process signal Events</code>。当<a href="http://man7.org/linux/man-pages/man7/signal.7.html" target="_blank" rel="noopener noreferrer">标准POSIX信号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>被触发(通常是process.kill(signal)或Ctrl+C等操作)，nodejs进程可以通过监听对应信号来进行回调。</p> <ul><li><code>SIGINT</code>：interrupt，程序终止信号，通常在用户按下CTRL+C时发出，用来通知前台进程终止进程。</li> <li><code>SIGTERM</code>：terminate，程序结束信号，通常用来要求程序自己正常退出。process.kill()缺省产生这个信号。</li></ul></li></ul> <h2 id="child-process"><a href="#child-process" aria-hidden="true" class="header-anchor">#</a> <a href="http://nodejs.cn/api/child_process.html" target="_blank" rel="noopener noreferrer">child_process<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>子程序，在node中，child_process这个模块非常重要。熟悉shell脚本的同学，可以用它的异步特性完成很多事情。</p> <p>异步<code>创建子程序</code>有四种方式，后三种底层都是spawn实现的:</p> <ul><li>child_process.spawn(command[, args][, options])</li> <li>child_process.exec(command[, options][, callback])</li> <li>child_process.execFile(file[, args][, options][, callback])</li> <li>child_process.fork(modulePath[, args][, options])</li></ul> <h3 id="create-child-process"><a href="#create-child-process" aria-hidden="true" class="header-anchor">#</a> create child_process</h3> <ul><li><code>child_process.spawn</code>。Node.js 的父进程与衍生的子进程之间会建立 stdin、stdout 和 stderr 的管道。
<ul><li><code>options.stdio</code>: stdio(标准输入输出) 用来配置子进程和父进程之间的 IO 通道,可以传递一个数组或者字符串。如，['pipe', 'pipe', 'pipe']，分别配置：标准输入、标准输出、标准错误。如果传递字符串，则三者将被配置成一样的值。简要介绍其中三个可以取的值：
<ul><li><code>pipe（默认）</code>：父子进程间建立 pipe 通道，可以通过 stream 的方式来操作 IO</li> <li><code>inherit</code>：子进程直接使用父进程的 IO(该种情况使用较多,子进程命令中，执行的node文件里使用process对象与主文件中一致)</li> <li><code>ignore</code>：不建立 pipe 通道，不能 pipe、不能监听 data 事件、IO 全被忽略</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ls <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'-al'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    stdio<span class="token punctuation">:</span> <span class="token string">'inherit'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data from child: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


ls<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error from child: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ls<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child exists with code: '</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>child_process.exec</code>。创建一个shell，然后在shell里执行命令。执行完成后，将stdout、stderr作为参数传入回调方法。exec 比较适合用来执行 shell 命令，然后获取输出。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'ls -al'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout: '</span> <span class="token operator">+</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stderr: '</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>events</code>。child_process支持以下事件：
<ul><li><code>exit</code>。子进程退出。注意其和close的区别，当exit触发时，其stdio流有可能还打开着，可以在此时做一些清理工作。通常情况下，child_process.kill()会触发该事件。</li> <li><code>close</code>。当子进程关闭时。通常情况下，child_process.kill()也会触发该事件。</li> <li><code>error</code>。当子进程不能关闭时，关闭它会报error事件。调用kill()可能会触发该事件。</li> <li><code>message</code>。跟child_process.send方法有关,父子进程间通信。</li> <li><code>disconnect</code>。跟child_process.disconnect方法有关。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> proc <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'pm2-runtime'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'proxy-server'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> stdio<span class="token punctuation">:</span> <span class="token string">'inherit'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> proc<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> proc<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGINT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGBREAK'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> proc<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGBREAK'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGHUP'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> proc<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGHUP'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

proc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>exit<span class="token punctuation">)</span>
</code></pre></div><h3 id="assert"><a href="#assert" aria-hidden="true" class="header-anchor">#</a> <a href>assert</a></h3> <ul><li><code>assert(value[, message])</code> assert.ok()的别名</li> <li><code>assert.equal(actual, expected[, message])</code> 比较是否相等。equal是非严格模式，官方推荐使用严格模式assert.strictEqual()。</li> <li>assert.notEqual(actual, expected[, message])</li> <li><code>assert.ok(value[, message])</code> 测试 value 是否为真值。相当于 assert.equal(!!value, true, message)</li> <li><code>assert.fail([message])</code> 抛出 AssertionError，并带上提供的错误信息或默认的错误信息。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK, 1 == '1'</span>
assert<span class="token punctuation">.</span><span class="token function">notEqual</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 测试通过。</span>
assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token number">123</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// // 抛出 AssertionError: false == true</span>
assert<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 AssertionError [ERR_ASSERTION]: 失败</span>
</code></pre></div><h2 id="参考文章"><a href="#参考文章" aria-hidden="true" class="header-anchor">#</a> 参考文章</h2> <ul><li><a href="https://www.cnblogs.com/chyingp/p/node-learning-guide-child_process.html" target="_blank" rel="noopener noreferrer">Nodejs进阶：如何玩转子进程（child_process）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/lq782655835/blogs/edit/master/docs/node/node-api-summary.md" target="_blank" rel="noopener noreferrer">帮助我改进页面内容！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">1/2/2019, 8:41:59 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blogs/dist/node/nginx.html" class="prev">
          Nginx反向代理
        </a></span> <span class="next"><a href="/blogs/dist/node/node-express-api.html">
          Express API及源码解析
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/blogs/dist/assets/js/21.28e649dd.js" defer></script><script src="/blogs/dist/assets/js/app.5da0cf1a.js" defer></script>
  </body>
</html>
